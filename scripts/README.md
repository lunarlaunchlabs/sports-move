# Scripts Directory

This directory contains all the automation scripts for deploying and managing the sports betting smart contracts.

## üìÅ Available Scripts

### Deployment & Setup

#### `generate-admin-wallets.js`
Generates 4 oracle admin wallets and stores them in `.env`.

```bash
npm run wallet:generate
# or
node scripts/generate-admin-wallets.js
```

**What it does:**
- Creates 4 new Aptos accounts (admin wallets)
- Stores private keys and addresses in `.env`
- Updates deployer credentials to use first admin
- Displays all generated addresses

#### `fund-wallets.js`
Funds all admin wallets from the Movement testnet faucet.

```bash
npm run wallet:fund
# or
node scripts/fund-wallets.js
```

**What it does:**
- Reads admin addresses from `.env`
- Requests 1 MOVE from faucet for each wallet
- Verifies funding was successful
- Reports any failures

#### `deploy-contracts.js`
Deploys the sports betting contracts to Movement Network.

```bash
npm run contract:deploy
# or
cd move && movement move publish --assume-yes --included-artifacts none
```

**What it does:**
- Updates `Move.toml` with deployer address
- Compiles the Move contracts
- Publishes to Movement Network
- Updates `.env` with contract addresses

**Note:** Currently using Movement CLI directly for deployment due to better compatibility.

#### `initialize-contracts.js`
Initializes the deployed contracts with admin addresses and initial funding.

```bash
npm run contract:init
# or
node scripts/initialize-contracts.js
```

**What it does:**
1. Initializes the smUSD stablecoin contract
2. Initializes sports betting contract with 4 admin addresses
3. Registers admins for smUSD
4. Mints 100,000 smUSD to Admin 1
5. Deposits 50,000 smUSD to house balance
6. Verifies all initialization steps

#### `register-remaining-admins.js`
Registers Admin 3 and Admin 4 for smUSD (used if they were funded after initial setup).

```bash
npm run wallet:register
# or
node scripts/register-remaining-admins.js
```

**What it does:**
- Registers Admin 3 for smUSD
- Registers Admin 4 for smUSD
- Confirms successful registration

### Utilities

#### `get-public-key.js`
Derives the public key from a private key.

```bash
npm run wallet:pubkey <PRIVATE_KEY>
# or
node scripts/get-public-key.js 0xYOUR_PRIVATE_KEY
```

**Usage:**
```bash
node scripts/get-public-key.js 0x945dd34a75f649eaf542966d2f1d9163da634184ca133e575437e549f4c80013
# Output: ed25519-pub-0x6cff3c7a45a79ddd6dd3f370d25ea23a133dcbd39415d7ac9845863840dcc25b
```

**What it does:**
- Takes a private key as input
- Generates corresponding Aptos account
- Outputs public key in Movement config format
- Used for creating Movement CLI config files

---

## üîÑ Typical Deployment Workflow

### First-Time Setup

```bash
# 1. Generate wallets
npm run wallet:generate

# 2. Fund wallets
npm run wallet:fund

# 3. Compile contracts
npm run contract:compile

# 4. Deploy contracts (requires Movement CLI)
cd move
movement move publish --assume-yes --included-artifacts none
cd ..

# 5. Initialize contracts
npm run contract:init

# 6. Register any remaining admins (if needed)
npm run wallet:register
```

### Or Use Quick Setup (Automated)

```bash
# Runs all steps except deployment (deployment needs Movement CLI config)
npm run setup:full
```

### After Manual Deployment

If you deployed manually using Movement CLI:

```bash
# Just initialize and register
npm run setup:init-only
```

---

## üìù Environment Variables

All scripts read from and write to `.env` file:

### Required Before Deployment
```bash
# Generated by wallet:generate
ADMIN1_PRIVATE_KEY=0x...
ADMIN1_ADDRESS=0x...
ADMIN2_PRIVATE_KEY=0x...
ADMIN2_ADDRESS=0x...
ADMIN3_PRIVATE_KEY=0x...
ADMIN3_ADDRESS=0x...
ADMIN4_PRIVATE_KEY=0x...
ADMIN4_ADDRESS=0x...
DEPLOYER_PRIVATE_KEY=0x...
DEPLOYER_ADDRESS=0x...
```

### Set After Deployment
```bash
# Updated by deployment process
CONTRACT_ADDRESS=0x...
SMUSD_MODULE_ADDRESS=0x...::smusd
BETTING_MODULE_ADDRESS=0x...::sports_betting
NODE_URL=https://testnet.movementnetwork.xyz/v1
```

---

## üõ†Ô∏è Movement CLI Configuration

For deployment, you need a `.movement/config.yaml` in the `move/` directory:

```yaml
---
profiles:
  default:
    network: Custom
    private_key: ed25519-priv-0xYOUR_PRIVATE_KEY
    public_key: ed25519-pub-0xYOUR_PUBLIC_KEY
    account: YOUR_ADDRESS_WITHOUT_0x
    rest_url: "https://testnet.movementnetwork.xyz/v1"
```

Use `get-public-key.js` to derive the public key from your private key.

---

## üß™ Testing Scripts

### `test-sports-move-contracts.js` (root directory)
Comprehensive integration test that simulates the entire betting flow.

```bash
npm run test:contracts
```

**What it tests:**
- Account setup and balance management
- smUSD minting and transfers
- Sports betting initialization
- Market creation
- Bet placement with automatic odds retrieval
- Market resolution
- Automated bet settlement
- House balance management
- View functions for markets and bets

### `test-contract-api.js` (root directory)
Tests the Movement Network API integration.

```bash
npm run test:contract-api
```

**What it tests:**
- POST endpoint (writing to blockchain)
- GET endpoint (reading from blockchain)
- Field-specific queries
- Error handling

---

## üîê Security Notes

1. **Never commit `.env`** - Already in `.gitignore`
2. **Backup your `.env`** - Store securely offline
3. **Testnet only** - These keys are for testnet use
4. **Rotate for mainnet** - Generate new keys for production
5. **Limit access** - Only share with authorized team members

---

## üìö Additional Resources

- [Movement Network Docs](https://docs.movementnetwork.xyz/)
- [Movement CLI Guide](https://docs.movementnetwork.xyz/devs/movementcli)
- [Aptos SDK Docs](https://aptos.dev/sdks/ts-sdk/)
- [Move Language Book](https://move-language.github.io/move/)

---

## üÜò Troubleshooting

### "Account not found" error
- Make sure the account is funded: `npm run wallet:fund`
- Wait a few seconds for faucet transaction to complete
- Verify balance on explorer

### "MODULE_ADDRESS_DOES_NOT_MATCH_SENDER" error
- Clear build cache: `cd move && rm -rf build`
- Recompile with correct address
- Ensure `Move.toml` matches deployer address

### "dotenv not found" error
- Install dependencies: `npm install`
- Ensure `.env` file exists in project root

### Deployment fails with network error
- Check Movement testnet status
- Verify RPC URL is correct
- Ensure you have sufficient gas tokens

---

**Last Updated:** November 24, 2025  
**Scripts Version:** 1.0.0
